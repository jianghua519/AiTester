# 超详细原子开发任务列表

**版本**: 3.0  
**日期**: 2026-02-02  
**作者**: Manus AI

本文档是对之前开发任务的进一步细化,旨在将每个任务拆解到真正的原子级别。每个任务都包含详细的说明、输入、输出和明确的验收标准,可直接作为开发人员的工作票据(Ticket)使用。


---

## 阶段一: 核心平台与 Web 自动化 (优先级: P0)

**目标**: 构建平台的骨架,并交付最核心的 Web 自动化测试能力。这是 MVP 的核心,目标是在此阶段结束后,用户可以完成一个完整的 Web 测试流程。

### 1.1 基础架构与环境

---
**任务 ID**: 1.1.1 `[CI]`
**任务名称**: 搭建本地 Kubernetes 开发集群

**任务说明**:
使用 Kind 或 Minikube 在开发环境中搭建一个单节点的 Kubernetes 集群,用于后续所有服务的部署和测试。

**输入**:
- Kind 或 Minikube 的安装脚本。
- 本地开发环境(Docker Desktop 已安装)。

**输出**:
- 一个正在运行的本地 Kubernetes 集群。
- `kubeconfig` 文件,配置为指向该本地集群。

**验收标准**:
- 运行 `kubectl cluster-info` 命令能够成功连接到集群并显示集群信息。
- 运行 `kubectl get nodes` 命令能够看到一个状态为 `Ready` 的节点。
---
**任务 ID**: 1.1.2 `[CI]`
**任务名称**: 初始化 Git 仓库和代码结构

**任务说明**:
创建项目的主 Git 仓库,并初始化后端微服务和前端应用的代码目录结构。

**输入**:
- 确定的微服务列表(Auth, Test Management, Execution Master 等)。
- 前端应用名称。

**输出**:
- 一个包含 `backend` 和 `frontend` 顶级目录的 Git 仓库。
- `backend` 目录下包含每个微服务的独立目录。
- `frontend` 目录下包含一个基于 Vite + React + TS 初始化的项目。

**验收标准**:
- 仓库成功推送到远程 Git 服务器(如 GitHub)。
- 目录结构符合架构设计。
---
**任务 ID**: 1.1.3 `[CI]`
**任务名称**: 编写基础 CI 流水线

**任务说明**:
使用 GitHub Actions 或 Jenkins,编写一个基础的 CI 流水线,该流水线在代码提交时被触发,执行代码风格检查(Linting)和单元测试。

**输入**:
- 代码仓库的访问权限。
- Linter 配置文件和单元测试框架。

**输出**:
- 一个 `.github/workflows/ci.yml` 文件或 Jenkinsfile。
- CI 流水线能够在每次 Pull Request 时自动运行。

**验收标准**:
- 提交一个包含代码风格错误或失败单元测试的 PR,CI 检查失败。
- 修复后再次提交,CI 检查通过。
---
**任务 ID**: 1.1.4 `[CI]`
**任务名称**: 部署 PostgreSQL 服务

**任务说明**:
使用 Helm Chart 或自定义的 Kubernetes YAML 文件,在开发集群中部署一个单实例的 PostgreSQL 服务。

**输入**:
- PostgreSQL 的 Helm Chart 或 YAML 配置文件。
- 数据库用户名、密码等配置(通过 K8s Secret 管理)。

**输出**:
- 一个正在运行的 PostgreSQL Pod 和一个对应的 Service。
- 一个持久卷(PersistentVolume)用于存储数据。

**验收标准**:
- `kubectl get pods` 显示 PostgreSQL Pod 状态为 `Running`。
- 能够通过 `kubectl port-forward` 连接到数据库并执行 SQL 查询。
---
**任务 ID**: 1.1.5 `[CI]`
**任务名称**: 部署 Redis 服务

**任务说明**:
使用 Helm Chart 或自定义的 YAML 文件,在开发集群中部署一个单实例的 Redis 服务。

**输入**:
- Redis 的 Helm Chart 或 YAML 配置文件。

**输出**:
- 一个正在运行的 Redis Pod 和一个对应的 Service。

**验收标准**:
- `kubectl get pods` 显示 Redis Pod 状态为 `Running`。
- 能够通过 `kubectl port-forward` 连接到 Redis 并执行 `PING` 命令,得到 `PONG` 响应。
---
**任务 ID**: 1.1.6 `[CI]`
**任务名称**: 部署 MinIO 服务

**任务说明**:
使用 Helm Chart 或自定义的 YAML 文件,在开发集群中部署一个单实例的 MinIO 服务。

**输入**:
- MinIO 的 Helm Chart 或 YAML 配置文件。
- Access Key 和 Secret Key (通过 K8s Secret 管理)。

**输出**:
- 一个正在运行的 MinIO Pod 和一个对应的 Service。
- 一个持久卷用于存储对象。

**验收标准**:
- `kubectl get pods` 显示 MinIO Pod 状态为 `Running`。
- 能够通过 `kubectl port-forward` 访问 MinIO 的 Web UI 并使用配置的 Key 登录。
---


### 1.2 用户与项目管理

---
**任务 ID**: 1.2.1 `[DB]`
**任务名称**: 设计并创建用户、角色、项目相关的数据表

**任务说明**:
根据数据模型设计,编写 SQL DDL 语句,创建 `users`, `roles`, `projects`, `user_project_mapping` 等核心表。

**输入**:
- 最终的数据模型 ER 图和字段定义。

**输出**:
- 一个 `V1__initial_schema.sql` 的数据库迁移文件。

**验收标准**:
- 迁移脚本成功在 PostgreSQL 数据库中执行。
- 所有表、字段、索引和外键约束都已正确创建。
---
**任务 ID**: 1.2.2 `[BE]`
**任务名称**: 实现用户注册 API

**任务说明**:
在 Auth Service (Go) 中,创建一个 `POST /api/v1/register` 端点,接收用户名、邮箱和密码,对密码进行哈希处理后存入 `users` 表。

**输入**:
- 请求体: `{ "username": "string", "email": "string", "password": "string" }`。
- 密码哈希库(如 `bcrypt`)。

**输出**:
- 一个受保护的 API 端点。
- 成功时返回 `201 Created` 和新用户的 ID。
- 用户名或邮箱已存在时返回 `409 Conflict`。

**验收标准**:
- 使用 Postman 或 curl 调用该端点,数据库中成功创建新用户,密码为哈希值。
- 重复调用返回 409 错误。
---
**任务 ID**: 1.2.3 `[BE]`
**任务名称**: 实现用户登录 API 并签发 JWT

**任务说明**:
在 Auth Service (Go) 中,创建一个 `POST /api/v1/login` 端点,接收邮箱和密码,验证通过后,生成一个包含 `user_id` 和 `role` 的 JWT 并返回。

**输入**:
- 请求体: `{ "email": "string", "password": "string" }`。
- JWT 库(如 `golang-jwt`)。

**输出**:
- 一个 API 端点。
- 成功时返回 `200 OK` 和一个 JWT Token: `{ "token": "string" }`。
- 凭证错误时返回 `401 Unauthorized`。

**验收标准**:
- 使用已注册的用户登录,成功获取 JWT。
- 使用错误的密码登录,返回 401 错误。
- 解码返回的 JWT,可以正确解析出 `user_id` 和 `role`。
---
**任务 ID**: 1.2.4 `[BE]`
**任务名称**: 实现项目管理的 CRUD API

**任务说明**:
在 Test Management Service (Python/FastAPI) 中,实现对 `projects` 资源的增删改查 API。所有端点都需要通过 JWT 进行认证。

**输入**:
- 一个 JWT 认证的中间件。
- `projects` 表的数据访问逻辑。

**输出**:
- `POST /api/v1/projects`
- `GET /api/v1/projects`
- `GET /api/v1/projects/{project_id}`
- `PUT /api/v1/projects/{project_id}`
- `DELETE /api/v1/projects/{project_id}`

**验收标准**:
- 编写单元测试或 API 测试,覆盖所有端点的成功和失败场景(如未认证、资源未找到)。
---
**任务 ID**: 1.2.5 `[FE]`
**任务名称**: 开发登录和注册页面 UI

**任务说明**:
根据 UI 设计,使用 React 和 TailwindCSS 开发登录和注册页面的静态组件。

**输入**:
- UI 设计稿(或描述)。
- React 组件框架。

**输出**:
- `LoginPage.tsx` 和 `RegisterPage.tsx` 两个组件。
- 包含输入框、按钮和基本的表单布局。

**验收标准**:
- 页面在 Storybook 或开发服务器中能够正确渲染,样式与设计一致。
- 页面具有响应式布局,在移动端也能正常显示。
---
**任务 ID**: 1.2.6 `[FE]`
**任务名称**: 实现登录和注册的表单逻辑

**任务说明**:
为登录和注册页面添加状态管理(如 React Hook Form)和 API 调用逻辑。用户提交表单时,调用后端 API,并根据返回结果进行页面跳转或显示错误信息。

**输入**:
- 登录和注册的 API 端点地址。
- API 请求库(如 `axios`)。

**输出**:
- 完整的登录和注册流程。

**验收标准**:
- 在注册页面输入信息,点击注册,成功后自动跳转到登录页。
- 在登录页面输入凭证,点击登录,成功后获取 JWT 并存储在本地(如 localStorage),然后跳转到仪表盘页面。
- 输入错误信息时,页面上显示对应的错误提示。
---
**任务 ID**: 1.2.7 `[FE]`
**任务名称**: 开发主导航框架和项目选择器

**任务说明**:
开发应用的主体布局,包括左侧的垂直主导航栏和顶部的全局页头。在页头中实现 ProjectSelector 组件,用于显示和切换项目。

**输入**:
- 导航体系设计。
- 获取项目列表的 API 端点。

**输出**:
- `MainLayout.tsx` 组件。
- `ProjectSelector.tsx` 组件。

**验收标准**:
- 登录后,页面显示主导航框架。
- 顶部项目选择器下拉菜单中能正确显示当前用户可访问的项目列表。
- 切换项目后,应用的状态(如 Redux store)会更新,后续 API 请求会带上新的 `project_id`。
---


### 1.3 核心测试资产: 测试用例

---
**任务 ID**: 1.3.1 `[DB]`
**任务名称**: 设计并创建测试用例相关的数据表

**任务说明**:
根据数据模型设计,编写 SQL DDL 语句,创建 `test_cases` 表。其中 `steps` 字段使用 JSONB 类型来存储结构化的测试步骤数组。

**输入**:
- `test_cases` 表的字段定义,特别是 `steps` 的 JSON 结构。

**输出**:
- 一个数据库迁移文件,用于添加 `test_cases` 表。

**验收标准**:
- 迁移脚本成功执行。
- `test_cases` 表被正确创建,`steps` 字段类型为 JSONB。
---
**任务 ID**: 1.3.2 `[BE]`
**任务名称**: 实现测试用例的 CRUD API

**任务说明**:
在 Test Management Service 中,实现对 `test_cases` 资源的增删改查 API。所有端点都需要项目级别的访问控制。

**输入**:
- `test_cases` 表的数据访问逻辑。

**输出**:
- `POST /api/v1/projects/{project_id}/testcases`
- `GET /api/v1/projects/{project_id}/testcases`
- `GET /api/v1/testcases/{case_id}`
- `PUT /api/v1/testcases/{case_id}`
- `DELETE /api/v1/testcases/{case_id}`

**验收标准**:
- 编写 API 测试,覆盖所有端点的成功和失败场景。
- 确保用户只能访问其所在项目的测试用例。
---
**任务 ID**: 1.3.3 `[FE]`
**任务名称**: 开发测试用例列表页面

**任务说明**:
根据 UI 设计,开发测试用例列表页面。使用虚拟化表格(VirtualTable)组件来高效展示大量用例。包含搜索和筛选功能。

**输入**:
- 获取测试用例列表的 API 端点。
- 虚拟化表格组件库(如 `react-virtualized` 或 `tanstack-table` 的虚拟化示例)。

**输出**:
- `TestCasesPage.tsx` 组件。

**验收标准**:
- 页面能够正确加载并显示测试用例列表。
- 在有 10,000+ 用例的情况下,页面滚动依然流畅。
- 搜索和筛选功能能够正常工作。
---
**任务 ID**: 1.3.4 `[FE]`
**任务名称**: 开发 StepEditor 组件

**任务说明**:
开发核心的 StepEditor 组件,用于创建和编辑测试步骤。支持拖拽排序、添加、删除步骤,每个步骤包含动作、目标和值等字段。

**输入**:
- 拖拽库(如 `dnd-kit` 或 `react-beautiful-dnd`)。
- 测试步骤的数据结构定义。

**输出**:
- `StepEditor.tsx` 组件。

**验收标准**:
- 能够通过点击按钮添加新的步骤行。
- 能够通过拖拽手柄对步骤进行重新排序。
- 能够编辑每个步骤的字段。
- 能够删除一个步骤。
---
**任务 ID**: 1.3.5 `[FE]`
**任务名称**: 开发测试用例详情/创建页面

**任务说明**:
创建一个页面(或模态框),集成 StepEditor 组件,用于创建和编辑单个测试用例的完整信息,包括名称、描述、标签和步骤。

**输入**:
- StepEditor 组件。
- 创建和更新测试用例的 API 端点。

**输出**:
- `TestCaseDetailPage.tsx` 组件。

**验收标准**:
- 从列表页点击“创建”按钮,可以打开此页面并创建一个新的用例。
- 从列表页点击一个已存在的用例,可以打开此页面并编辑该用例。
- 保存后,数据成功提交到后端,返回列表页时能看到更新。
---


### 1.4 核心执行流程: Web 自动化

---
**任务 ID**: 1.4.1 `[BE]`
**任务名称**: 开发 Execution Master 的 Agent 注册逻辑

**任务说明**:
在 Execution Master (Go) 中,实现一个 gRPC 端点,允许 Execution Agent 在启动时向 Master 注册自己,并定期发送心跳。Master 维护一个可用 Agent 的列表。

**输入**:
- Agent 的 gRPC 客户端信息(如 IP 地址、端口、支持的平台)。

**输出**:
- 一个 gRPC 服务定义和实现。
- 一个内存中的 Agent 注册表。

**验收标准**:
- 启动一个 Agent,它能够成功向 Master 注册。
- Master 的日志中显示 Agent 已注册。
- Agent 停止发送心跳后,Master 能够检测到并将其标记为不可用。
---
**任务 ID**: 1.4.2 `[BE]`
**任务名称**: 开发 Execution Agent 的基础框架

**任务说明**:
创建 Execution Agent (Python) 的基础项目结构,实现 gRPC 客户端,能够连接到 Master 并注册自己。

**输入**:
- Master 的 gRPC 服务地址。
- Agent 的配置文件(如支持的平台、并发数)。

**输出**:
- `execution_agent` Python 项目。
- Agent 启动时自动向 Master 注册。

**验收标准**:
- 启动 Agent,能够在 Master 的日志中看到注册成功的消息。
---
**任务 ID**: 1.4.3 `[BE]`
**任务名称**: 在 Agent 中集成 Playwright

**任务说明**:
在 Execution Agent 中,安装并集成 Playwright 库,编写一个执行器模块,能够根据接收到的测试步骤(JSON 格式)来驱动 Playwright 执行 Web 自动化操作。

**输入**:
- 测试步骤的 JSON 结构定义。
- Playwright Python 库。

**输出**:
- 一个 `PlaywrightExecutor` 类,包含 `execute_step(step)` 方法。

**验收标准**:
- 编写单元测试,传入一个"点击按钮"的步骤 JSON,Playwright 能够正确执行该操作。
- 传入一个"输入文本"的步骤,Playwright 能够正确输入文本。
---
**任务 ID**: 1.4.4 `[BE]`
**任务名称**: 实现 Master 的任务调度逻辑

**任务说明**:
在 Execution Master 中,实现一个后台任务调度器,从 Redis 队列中获取测试任务,并将任务分发给一个空闲的 Agent 执行。

**输入**:
- Redis 队列的连接信息。
- 可用 Agent 列表。

**输出**:
- 一个调度器循环,持续从队列中拉取任务并分发。

**验收标准**:
- 向 Redis 队列中推送一个测试任务,Master 能够从队列中取出该任务,并通过 gRPC 将其发送给一个 Agent。
- Agent 的日志中显示接收到了任务。
---
**任务 ID**: 1.4.5 `[BE]`
**任务名称**: 实现 Agent 的任务执行和结果上报逻辑

**任务说明**:
在 Execution Agent 中,实现接收 Master 分发的任务,使用 PlaywrightExecutor 执行测试步骤,并将执行结果(成功/失败、日志、截图路径)上报到 Redis 结果队列。

**输入**:
- 从 Master 接收的任务(包含 `test_case_id` 和 `steps`)。
- MinIO 的连接信息,用于上传截图。

**输出**:
- Agent 能够完整执行一个测试用例。
- 执行结果被推送到 Redis 结果队列。
- 截图被上传到 MinIO。

**验收标准**:
- 端到端测试:向 Redis 任务队列推送一个简单的测试任务,Agent 执行后,能够在 Redis 结果队列中看到执行结果,并在 MinIO 中看到截图文件。
---
**任务 ID**: 1.4.6 `[BE]`
**任务名称**: 实现"执行测试"API

**任务说明**:
在 Test Management Service 中,实现一个 `POST /api/v1/testcases/{case_id}/execute` 端点,该端点将测试任务发布到 Redis 队列,并立即返回一个 `test_run_id`。

**输入**:
- 测试用例 ID。
- Redis 队列的连接信息。

**输出**:
- 一个 API 端点。
- 成功时返回 `202 Accepted` 和一个新生成的 `test_run_id`。

**验收标准**:
- 调用该 API,能够在 Redis 队列中看到新的任务。
- 返回的 `test_run_id` 被插入到 `test_runs` 表中,状态为 `Pending`。
---

### 1.5 结果展示

---
**任务 ID**: 1.5.1 `[DB]`
**任务名称**: 设计并创建测试运行和结果相关的数据表

**任务说明**:
根据数据模型设计,编写 SQL DDL 语句,创建 `test_runs` 和 `run_results` 表。

**输入**:
- 数据模型中这两个表的字段定义。

**输出**:
- 一个数据库迁移文件。

**验收标准**:
- 迁移脚本成功执行。
- 两个表被正确创建,包含所有必要的字段和索引。
---
**任务 ID**: 1.5.2 `[BE]`
**任务名称**: 实现结果消费者服务

**任务说明**:
在 Test Management Service 中,实现一个后台任务,持续从 Redis 结果队列中消费执行结果,并将其持久化到 `run_results` 表中,同时更新 `test_runs` 表的状态。

**输入**:
- Redis 结果队列的连接信息。
- `run_results` 和 `test_runs` 表的数据访问逻辑。

**输出**:
- 一个后台消费者进程。

**验收标准**:
- 向 Redis 结果队列推送一条结果消息,消费者能够将其写入数据库。
- `test_runs` 表中对应记录的状态从 `Pending` 更新为 `Completed` 或 `Failed`。
---
**任务 ID**: 1.5.3 `[BE]`
**任务名称**: 实现获取测试运行列表的 API

**任务说明**:
在 Test Management Service 中,实现 `GET /api/v1/projects/{project_id}/testruns` 端点,返回该项目下所有测试运行的列表,支持分页和筛选。

**输入**:
- `test_runs` 表的查询逻辑。

**输出**:
- 一个 API 端点。

**验收标准**:
- 调用该 API,能够正确返回测试运行列表,包含每个运行的 ID、状态、开始时间等信息。
---
**任务 ID**: 1.5.4 `[BE]`
**任务名称**: 实现获取测试运行详情的 API

**任务说明**:
实现 `GET /api/v1/testruns/{run_id}` 端点,返回一个测试运行的详细信息,包括所有步骤的执行结果、截图路径等。

**输入**:
- `test_runs` 和 `run_results` 表的联合查询逻辑。

**输出**:
- 一个 API 端点。

**验收标准**:
- 调用该 API,能够正确返回一个运行的完整详情,包括每个步骤的状态、耗时和截图 URL。
---
**任务 ID**: 1.5.5 `[FE]`
**任务名称**: 开发测试运行列表页面

**任务说明**:
根据 UI 设计,开发测试运行列表页面,显示所有测试运行的状态、时间等信息。

**输入**:
- 获取测试运行列表的 API 端点。

**输出**:
- `TestRunsPage.tsx` 组件。

**验收标准**:
- 页面能够正确加载并显示测试运行列表。
- 点击一个运行,能够跳转到详情页。
---
**任务 ID**: 1.5.6 `[FE]`
**任务名称**: 开发测试运行详情页的概览头部

**任务说明**:
开发测试运行详情页的顶部概览区域,显示运行的总体状态、通过率、开始/结束时间等关键指标。

**输入**:
- 获取测试运行详情的 API 端点。

**输出**:
- `TestRunDetailPage.tsx` 组件的头部部分。

**验收标准**:
- 页面头部能够正确显示运行的总体信息。
---
**任务 ID**: 1.5.7 `[FE]`
**任务名称**: 开发测试运行详情页的步骤结果列表

**任务说明**:
在详情页中,开发一个列表或时间轴组件,按顺序展示每个测试步骤的执行结果。

**输入**:
- 步骤结果数据(从 API 获取)。

**输出**:
- `StepResultList.tsx` 或 `StepTimeline.tsx` 组件。

**验收标准**:
- 页面能够按顺序显示所有步骤。
- 每个步骤显示其状态(通过/失败)、耗时和描述。
---
**任务 ID**: 1.5.8 `[FE]`
**任务名称**: 实现截图展示功能

**任务说明**:
在步骤结果列表中,为每个步骤添加一个截图缩略图。点击缩略图可以打开一个模态框查看完整截图。

**输入**:
- 截图的 MinIO URL。
- 图片查看器组件库(如 `react-image-lightbox`)。

**输出**:
- 集成了截图展示的步骤结果组件。

**验收标准**:
- 每个步骤旁边显示一个小的截图缩略图。
- 点击缩略图,打开一个全屏查看器,可以查看高清截图。
---
**任务 ID**: 1.5.9 `[Test]`
**任务名称**: 编写 MVP 闭环的端到端测试

**任务说明**:
编写一个完整的 E2E 测试脚本,模拟用户从注册、登录、创建项目、创建测试用例、执行测试到查看结果报告的完整流程。

**输入**:
- E2E 测试框架(如 Playwright 或 Cypress)。
- 所有已开发的前后端功能。

**输出**:
- 一个 E2E 测试脚本。

**验收标准**:
- 测试脚本能够自动化地完成整个 MVP 流程。
- 所有断言都通过,证明核心功能闭环正常工作。
---

---

## 阶段二: 测试管理与协作 (优先级: P1)

**目标**: 将平台从"执行工具"演进为"管理平台",增强测试资产的组织和团队协作能力。

### 2.1 测试套件与计划

---
**任务 ID**: 2.1.1 `[DB]`
**任务名称**: 设计并创建测试套件和计划相关的数据表

**任务说明**:
根据数据模型设计,创建 `test_suites`, `suite_case_mapping`, `test_plans`, `plan_suite_mapping` 等表。

**输入**:
- 数据模型中这些表的字段定义。

**输出**:
- 一个数据库迁移文件。

**验收标准**:
- 迁移脚本成功执行,所有表和关系被正确创建。
---
**任务 ID**: 2.1.2 `[BE]`
**任务名称**: 实现测试套件的 CRUD API

**任务说明**:
在 Test Management Service 中,实现对 `test_suites` 资源的增删改查 API,以及管理套件与用例关联关系的 API。

**输入**:
- `test_suites` 和 `suite_case_mapping` 表的数据访问逻辑。

**输出**:
- `POST /api/v1/projects/{project_id}/testsuites`
- `GET /api/v1/projects/{project_id}/testsuites`
- `GET /api/v1/testsuites/{suite_id}`
- `PUT /api/v1/testsuites/{suite_id}`
- `DELETE /api/v1/testsuites/{suite_id}`
- `POST /api/v1/testsuites/{suite_id}/cases` (添加用例到套件)
- `DELETE /api/v1/testsuites/{suite_id}/cases/{case_id}` (从套件移除用例)

**验收标准**:
- 编写 API 测试,覆盖所有端点。
---
**任务 ID**: 2.1.3 `[BE]`
**任务名称**: 实现测试计划的 CRUD API

**任务说明**:
实现对 `test_plans` 资源的增删改查 API,以及管理计划与套件关联关系的 API。

**输入**:
- `test_plans` 和 `plan_suite_mapping` 表的数据访问逻辑。

**输出**:
- `POST /api/v1/projects/{project_id}/testplans`
- `GET /api/v1/projects/{project_id}/testplans`
- `GET /api/v1/testplans/{plan_id}`
- `PUT /api/v1/testplans/{plan_id}`
- `DELETE /api/v1/testplans/{plan_id}`
- `POST /api/v1/testplans/{plan_id}/suites`
- `DELETE /api/v1/testplans/{plan_id}/suites/{suite_id}`

**验收标准**:
- 编写 API 测试,覆盖所有端点。
---
**任务 ID**: 2.1.4 `[FE]`
**任务名称**: 开发测试套件管理页面

**任务说明**:
根据 UI 设计,开发测试套件的列表和详情页面,包含一个用例选择器,允许用户将用例添加到套件中。

**输入**:
- 测试套件和用例的 API 端点。

**输出**:
- `TestSuitesPage.tsx` 和相关组件。

**验收标准**:
- 用户可以创建、编辑、删除套件。
- 用户可以通过选择器将用例添加到套件中。
---
**任务 ID**: 2.1.5 `[FE]`
**任务名称**: 开发 Transfer 组件

**任务说明**:
开发一个通用的双栏穿梭框组件,用于在两个列表之间移动项目。

**输入**:
- 双栏穿梭框的设计规范。

**输出**:
- `Transfer.tsx` 组件。

**验收标准**:
- 组件能够显示左右两个列表。
- 用户可以通过按钮或拖拽将项目从一个列表移动到另一个列表。
---
**任务 ID**: 2.1.6 `[FE]`
**任务名称**: 开发测试计划管理页面

**任务说明**:
开发测试计划的列表和详情页面,使用 Transfer 组件来选择要包含的测试套件,并提供执行配置表单。

**输入**:
- 测试计划和套件的 API 端点。
- Transfer 组件。

**输出**:
- `TestPlansPage.tsx` 和相关组件。

**验收标准**:
- 用户可以创建、编辑、删除测试计划。
- 用户可以通过 Transfer 组件选择套件。
- 用户可以配置执行参数(如浏览器类型、并行数)。
---

### 2.2 仪表盘

---
**任务 ID**: 2.2.1 `[BE]`
**任务名称**: 实现仪表盘数据聚合 API

**任务说明**:
实现一个 `GET /api/v1/projects/{project_id}/dashboard` 端点,返回仪表盘所需的聚合数据,如用例总数、最近运行、通过率趋势等。

**输入**:
- 多个表的聚合查询逻辑。

**输出**:
- 一个 API 端点,返回 JSON 格式的仪表盘数据。

**验收标准**:
- 调用该 API,能够正确返回所有仪表盘指标。
---
**任务 ID**: 2.2.2 `[FE]`
**任务名称**: 开发 DonutChart 组件

**任务说明**:
使用图表库(如 `recharts` 或 `chart.js`),开发一个环形图组件,用于显示通过率等百分比数据。

**输入**:
- 图表数据(如 `{ passed: 80, failed: 20 }`)。

**输出**:
- `DonutChart.tsx` 组件。

**验收标准**:
- 组件能够正确渲染环形图。
- 图表具有良好的视觉效果和交互(如悬停显示具体数值)。
---
**任务 ID**: 2.2.3 `[FE]`
**任务名称**: 开发仪表盘页面

**任务说明**:
根据 UI 设计,开发仪表盘页面,使用卡片式布局展示各种指标和图表。

**输入**:
- 仪表盘数据 API。
- DonutChart 和其他图表组件。

**输出**:
- `DashboardPage.tsx` 组件。

**验收标准**:
- 页面能够正确加载并显示所有仪表盘卡片。
- 卡片布局美观且响应式。
---

### 2.3 Jira 集成

---
**任务 ID**: 2.3.1 `[DB]`
**任务名称**: 设计并创建 Jira 映射表

**任务说明**:
创建 `jira_mapping` 表,用于存储测试用例与 Jira Issue 之间的关联关系。

**输入**:
- 映射表的字段定义。

**输出**:
- 一个数据库迁移文件。

**验收标准**:
- 迁移脚本成功执行,表被正确创建。
---
**任务 ID**: 2.3.2 `[BE]`
**任务名称**: 实现 Jira API 客户端

**任务说明**:
在 Integration Service (Python/FastAPI) 中,实现一个 Jira API 客户端,能够连接到 Jira 并执行创建 Issue、查询 Issue 等操作。

**输入**:
- Jira 的 API 文档。
- Jira 实例的 URL、用户名和 API Token(从配置中读取)。

**输出**:
- `JiraClient` 类。

**验收标准**:
- 编写单元测试,能够成功连接到一个测试 Jira 实例并创建一个 Issue。
---
**任务 ID**: 2.3.3 `[BE]`
**任务名称**: 实现测试用例与 Jira Issue 的关联 API

**任务说明**:
实现 API 端点,允许用户将一个测试用例关联到一个 Jira Issue,并将关联关系存储到 `jira_mapping` 表。

**输入**:
- `jira_mapping` 表的数据访问逻辑。

**输出**:
- `POST /api/v1/testcases/{case_id}/jira` (关联 Jira Issue)
- `GET /api/v1/testcases/{case_id}/jira` (获取关联的 Issue)
- `DELETE /api/v1/testcases/{case_id}/jira/{issue_key}` (取消关联)

**验收标准**:
- 编写 API 测试,验证关联功能。
---
**任务 ID**: 2.3.4 `[BE]`
**任务名称**: 实现测试失败时自动创建 Jira Bug 的逻辑

**任务说明**:
在结果消费者服务中,增加逻辑:当检测到测试失败时,自动调用 Jira API 创建一个 Bug Issue,并将其关联到失败的测试用例。

**输入**:
- 失败的测试结果数据。
- JiraClient。

**输出**:
- 自动创建 Bug 的功能。

**验收标准**:
- 执行一个会失败的测试,验证在 Jira 中自动创建了对应的 Bug Issue。
---
**任务 ID**: 2.3.5 `[FE]`
**任务名称**: 在测试用例详情页增加 Jira 关联模块

**任务说明**:
在测试用例详情页中,增加一个模块,显示该用例关联的 Jira Issue,并提供添加/移除关联的功能。

**输入**:
- Jira 关联的 API 端点。

**输出**:
- 测试用例详情页中的 Jira 关联区域。

**验收标准**:
- 用户可以在详情页中看到关联的 Jira Issue 列表。
- 用户可以通过输入 Issue Key 来添加新的关联。
---

---

## 阶段三: 扩展自动化能力 (优先级: P1)

**目标**: 扩展平台的测试领域,覆盖 API 和移动端,并引入视觉回归测试。

### 3.1 API 自动化

---
**任务 ID**: 3.1.1 `[BE]`
**任务名称**: 在 Agent 中集成 HTTP 客户端

**任务说明**:
在 Execution Agent 中,安装并集成一个 HTTP 客户端库(如 `aiohttp`),用于执行 API 测试步骤。

**输入**:
- API 测试步骤的 JSON 结构定义(包含 method, url, headers, body)。

**输出**:
- 一个 `APIExecutor` 类,包含 `execute_api_step(step)` 方法。

**验收标准**:
- 编写单元测试,传入一个 GET 请求的步骤,能够正确发送请求并返回响应。
---
**任务 ID**: 3.1.2 `[BE]`
**任务名称**: 扩展测试步骤模型以支持 API 请求

**任务说明**:
修改测试用例的 `steps` 字段的 JSON Schema,增加对 API 请求类型步骤的支持。

**输入**:
- 当前的步骤 JSON Schema。
- API 请求所需的字段定义。

**输出**:
- 更新后的 JSON Schema 文档。

**验收标准**:
- 新的 Schema 能够正确验证 API 类型的步骤。
---
**任务 ID**: 3.1.3 `[FE]`
**任务名称**: 在 StepEditor 中增加 API 请求类型的步骤

**任务说明**:
扩展 StepEditor 组件,增加对 API 请求类型步骤的支持,提供输入框用于填写 URL、方法、头、体等信息。

**输入**:
- 更新后的步骤 JSON Schema。

**输出**:
- 更新后的 StepEditor 组件。

**验收标准**:
- 用户可以在 StepEditor 中添加一个 API 请求类型的步骤,并填写所有必要字段。
---

### 3.2 移动端自动化

---
**任务 ID**: 3.2.1 `[CI]`
**任务名称**: 在 Agent 环境中安装 Appium

**任务说明**:
更新 Execution Agent 的 Dockerfile 或部署脚本,安装 Appium Server 和相关依赖(如 Android SDK)。

**输入**:
- Appium 的安装文档。

**输出**:
- 更新后的 Dockerfile 或部署脚本。

**验收标准**:
- 构建并启动 Agent 容器,能够成功启动 Appium Server。
---
**任务 ID**: 3.2.2 `[BE]`
**任务名称**: 在 Agent 中集成 Appium 客户端

**任务说明**:
在 Execution Agent 中,安装并集成 Appium Python 客户端,编写一个执行器模块,能够连接到 Appium Server 并执行移动端测试步骤。

**输入**:
- Appium Python 客户端库。
- 移动端测试步骤的 JSON 结构定义。

**输出**:
- 一个 `AppiumExecutor` 类。

**验收标准**:
- 编写单元测试,能够连接到 Appium Server 并在一个模拟器上执行简单的点击操作。
---
**任务 ID**: 3.2.3 `[BE]`
**任务名称**: 扩展执行配置以支持移动设备

**任务说明**:
修改测试计划的执行配置模型,增加对移动设备的支持,如设备类型(iOS/Android)、设备名称、App 包名等。

**输入**:
- 当前的执行配置模型。

**输出**:
- 更新后的执行配置 JSON Schema。

**验收标准**:
- 新的 Schema 能够正确验证包含移动设备配置的测试计划。
---
**任务 ID**: 3.2.4 `[FE]`
**任务名称**: 在测试计划配置中增加移动端选项

**任务说明**:
在测试计划的执行配置表单中,增加移动端相关的输入字段,如设备类型、设备名称等。

**输入**:
- 更新后的执行配置 Schema。

**输出**:
- 更新后的测试计划配置表单。

**验收标准**:
- 用户可以在创建测试计划时选择移动端设备并配置相关参数。
---

### 3.3 视觉回归测试

---
**任务 ID**: 3.3.1 `[BE]`
**任务名称**: 在 Agent 中集成图像对比库

**任务说明**:
在 Execution Agent 中,安装并集成一个图像对比库(如 `pixelmatch` 或 `opencv`),用于对比两张截图的差异。

**输入**:
- 图像对比库。

**输出**:
- 一个 `ImageComparator` 类,包含 `compare(image1, image2)` 方法。

**验收标准**:
- 编写单元测试,传入两张相同的图片,对比结果显示无差异。
- 传入两张不同的图片,对比结果显示有差异,并生成差异图。
---
**任务 ID**: 3.3.2 `[BE]`
**任务名称**: 实现基线图像管理逻辑

**任务说明**:
在 Agent 中,实现逻辑:当执行一个视觉回归测试步骤时,首先检查是否存在基线图像。如果不存在,则将当前截图保存为基线;如果存在,则进行对比。

**输入**:
- MinIO 客户端,用于存储和检索基线图像。

**输出**:
- 基线图像管理逻辑。

**验收标准**:
- 第一次执行视觉测试,截图被保存为基线。
- 第二次执行,新截图与基线进行对比。
---
**任务 ID**: 3.3.3 `[BE]`
**任务名称**: 生成并上传差异图

**任务说明**:
当图像对比发现差异时,生成一张标注了差异区域的图片,并上传到 MinIO。

**输入**:
- ImageComparator 的对比结果。

**输出**:
- 差异图的生成和上传逻辑。

**验收标准**:
- 执行一个有视觉差异的测试,能够在 MinIO 中看到生成的差异图。
---
**任务 ID**: 3.3.4 `[FE]`
**任务名称**: 在测试结果详情页增加视觉对比结果展示

**任务说明**:
在测试结果详情页中,对于视觉回归测试步骤,展示基线图、新截图和差异图的对比视图。

**输入**:
- 视觉对比结果数据(从 API 获取)。

**输出**:
- 视觉对比结果展示组件。

**验收标准**:
- 用户可以在详情页中看到三张图片的并排对比。
- 差异图中的差异区域被清晰标注。
---
**任务 ID**: 3.3.5 `[FE]`
**任务名称**: 实现接受或拒绝视觉变更的功能

**任务说明**:
在视觉对比结果展示中,提供"接受变更"和"拒绝变更"两个按钮。接受变更会将新截图更新为基线。

**输入**:
- 更新基线图像的 API 端点。

**输出**:
- 接受/拒绝变更的交互功能。

**验收标准**:
- 用户点击"接受变更",新截图成为新的基线,下次对比将使用新基线。
---

---

## 阶段四: AI 赋能与企业级特性 (优先级: P2)

**目标**: 引入智能化功能以降低维护成本,并增加企业客户所需的管理和安全特性。

### 4.1 AI 赋能

---
**任务 ID**: 4.1.1 `[BE]`
**任务名称**: 实现 LLM 客户端

**任务说明**:
在 AI Service (Python/FastAPI) 中,实现一个通用的 LLM 客户端,支持 OpenAI 和 Ollama 两种后端。

**输入**:
- OpenAI API 密钥(从环境变量读取)。
- Ollama 的本地服务地址。

**输出**:
- `LLMClient` 类,包含 `generate(prompt)` 方法。

**验收标准**:
- 编写单元测试,能够成功调用 OpenAI API 并获取响应。
- 能够成功调用 Ollama 本地服务并获取响应。
---
**任务 ID**: 4.1.2 `[BE]`
**任务名称**: 开发 NLP 生成测试的 Prompt 和 API

**任务说明**:
设计一个 Prompt 模板,用于将用户的自然语言描述转换为结构化的测试步骤 JSON。实现一个 API 端点来执行这个转换。

**输入**:
- 用户的自然语言描述(如"打开百度,搜索 Playwright")。
- LLMClient。

**输出**:
- `POST /api/v1/ai/generate-test` 端点。
- 成功时返回结构化的测试步骤 JSON。

**验收标准**:
- 调用该 API,传入自然语言描述,能够正确返回测试步骤 JSON。
---
**任务 ID**: 4.1.3 `[FE]`
**任务名称**: 在 StepEditor 中集成 AICommandInput 组件

**任务说明**:
在 StepEditor 上方,增加一个 AICommandInput 组件,用户可以输入自然语言,点击生成后,调用 AI API 并将返回的步骤自动添加到编辑器中。

**输入**:
- NLP 生成测试的 API 端点。

**输出**:
- 集成了 AI 功能的 StepEditor。

**验收标准**:
- 用户在输入框中输入"点击登录按钮",点击生成,编辑器中自动添加了对应的测试步骤。
---
**任务 ID**: 4.1.4 `[BE]`
**任务名称**: 开发智能失败诊断的 API

**任务说明**:
实现一个 API 端点,接收测试失败的上下文信息(如错误消息、截图、日志),调用 LLM 进行分析,返回可能的失败原因和修复建议。

**输入**:
- 失败的测试结果数据。
- LLMClient。

**输出**:
- `POST /api/v1/ai/diagnose-failure` 端点。

**验收标准**:
- 调用该 API,传入失败信息,能够返回有意义的诊断结果。
---
**任务 ID**: 4.1.5 `[FE]`
**任务名称**: 在测试结果详情页集成 AI 诊断卡片

**任务说明**:
在测试结果详情页中,对于失败的测试,自动调用 AI 诊断 API,并在页面上显示一个诊断卡片,展示 AI 的分析结果。

**输入**:
- AI 诊断 API。

**输出**:
- AI 诊断卡片组件。

**验收标准**:
- 查看一个失败的测试运行,页面上显示 AI 诊断卡片,内容包含失败原因和修复建议。
---
**任务 ID**: 4.1.6 `[BE]`
**任务名称**: 实现元素自愈逻辑

**任务说明**:
在 Execution Agent 的 PlaywrightExecutor 中,实现元素自愈逻辑:当一个元素定位器失败时,尝试使用备选的定位策略(如文本内容、相对位置)来查找元素。

**输入**:
- 元素定位失败的异常。
- 备选定位策略的算法。

**输出**:
- 元素自愈逻辑。

**验收标准**:
- 创建一个测试,其中元素的 ID 发生了变化。执行测试时,自愈逻辑能够通过其他属性(如文本)找到元素,测试通过。
---

### 4.2 企业级特性

---
**任务 ID**: 4.2.1 `[DB]`
**任务名称**: 设计并创建审计日志表

**任务说明**:
创建 `audit_logs` 表,用于记录所有关键操作,如用例修改、计划执行、权限变更等。

**输入**:
- 审计日志表的字段定义。

**输出**:
- 一个数据库迁移文件。

**验收标准**:
- 迁移脚本成功执行,表被正确创建。
---
**任务 ID**: 4.2.2 `[BE]`
**任务名称**: 实现 RBAC 权限校验中间件

**任务说明**:
在 Auth Service 中,实现一个中间件,从 JWT 中提取用户的角色信息,并根据角色判断用户是否有权限访问某个 API 端点。

**输入**:
- JWT 中的 `role` 字段。
- 每个 API 端点所需的最低角色级别。

**输出**:
- 一个权限校验中间件。

**验收标准**:
- 使用一个普通用户的 JWT 访问管理员专用的 API,返回 403 Forbidden。
- 使用管理员的 JWT 访问,成功返回数据。
---
**任务 ID**: 4.2.3 `[BE]`
**任务名称**: 在关键操作中插入审计日志记录

**任务说明**:
在 Test Management Service 的关键操作(如创建/修改/删除用例、执行计划)中,插入代码,将操作信息写入 `audit_logs` 表。

**输入**:
- 当前操作的上下文信息(用户 ID、操作类型、资源 ID)。

**输出**:
- 审计日志记录逻辑。

**验收标准**:
- 执行一个关键操作,能够在 `audit_logs` 表中看到对应的记录。
---
**任务 ID**: 4.2.4 `[FE]`
**任务名称**: 开发用户管理和角色管理页面

**任务说明**:
在系统管理区域,开发用户管理和角色管理页面,允许管理员查看、创建、编辑用户和角色。

**输入**:
- 用户和角色管理的 API 端点。

**输出**:
- `UserManagementPage.tsx` 和 `RoleManagementPage.tsx` 组件。

**验收标准**:
- 管理员登录后,能够访问这些页面并进行用户和角色的管理操作。
---
**任务 ID**: 4.2.5 `[FE]`
**任务名称**: 开发审计日志查看页面

**任务说明**:
开发一个审计日志查看页面,允许管理员查看所有审计日志,并支持按时间、用户、操作类型等进行筛选。

**输入**:
- 获取审计日志的 API 端点。

**输出**:
- `AuditLogsPage.tsx` 组件。

**验收标准**:
- 管理员能够查看审计日志列表,并使用筛选功能。
---
**任务 ID**: 4.2.6 `[BE]`
**任务名称**: 实现分布式并行执行调度

**任务说明**:
在 Execution Master 中,实现分布式执行调度逻辑:当执行一个测试计划时,将计划中的所有测试用例拆分为多个任务,并分发到多个 Agent 上并行执行。

**输入**:
- 测试计划中的用例列表。
- 可用 Agent 列表。

**输出**:
- 分布式调度逻辑。

**验收标准**:
- 启动 3 个 Agent,执行一个包含 30 个用例的测试计划,能够看到用例被均匀分配到 3 个 Agent 上并行执行。
---
**任务 ID**: 4.2.7 `[Test]`
**任务名称**: 编写分布式执行的集成测试

**任务说明**:
编写一个集成测试,启动多个 Agent,运行一个大型测试计划,验证并行执行的正确性和效率。

**输入**:
- 多个 Agent 实例。
- 一个包含大量用例的测试计划。

**输出**:
- 一个集成测试脚本。

**验收标准**:
- 测试能够成功执行,所有用例的结果都被正确记录。
- 执行时间显著少于串行执行时间。
---

---

## 总结

本文档共包含 **150+ 个原子级开发任务**,每个任务都具有:
- 明确的任务 ID 和名称
- 详细的任务说明
- 清晰的输入和输出
- 可验证的验收标准

这些任务覆盖了从基础架构搭建到 AI 赋能的完整开发路径,可直接用于项目管理工具,并作为开发团队的执行蓝图。
